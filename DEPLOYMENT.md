# Deployment Guide for Sandwich Project Platform

## Architecture Overview
- **Frontend**: React app hosted on GitHub Pages
- **Backend**: Node.js/Express API hosted on Render
- **Database**: PostgreSQL hosted on Supabase
- **Authentication**: Supabase Auth

## Step 1: Deploy Backend to Render

### 1.1 Create Render Account
1. Go to [render.com](https://render.com) and sign up
2. Connect your GitHub account

### 1.2 Create New Web Service
1. Click "New +" → "Web Service"
2. Connect your repository: `nicunursekatie/sandwichprojectplatform`
3. Configure the service:
   - **Name**: `sandwich-project-api`
   - **Environment**: `Node`
   - **Build Command**: `npm install && npm run build:server`
   - **Start Command**: `npm run start:server`

### 1.3 Set Environment Variables
In Render dashboard, add these environment variables:

```bash
# Required
DATABASE_URL=postgres://postgres:Sandwich%21Project1328@db.mifquzfaqtcyboqntfyn.supabase.co:6543/postgres
VITE_SUPABASE_URL=https://mifquzfaqtcyboqntfyn.supabase.co
VITE_SUPABASE_ANON_KEY=[Your Supabase anon key]
SUPABASE_SERVICE_ROLE_KEY=[Your Supabase service role key]
SENDGRID_API_KEY=[Your SendGrid API key]
PORT=5001
NODE_ENV=production
CORS_ORIGIN=https://nicunursekatie.github.io

# Optional
FROM_EMAIL=noreply@sandwichproject.org
SESSION_SECRET=(will be auto-generated by Render)
```

### 1.4 Deploy
Click "Create Web Service" and wait for the build to complete. Your backend URL will be:
`https://sandwich-project-api-[random].onrender.com`

## Step 2: Configure GitHub Pages Frontend

### 2.1 Set GitHub Secrets
Go to your GitHub repository → Settings → Secrets and variables → Actions

Add these secrets:
- `VITE_SUPABASE_URL`: `https://mifquzfaqtcyboqntfyn.supabase.co`
- `VITE_SUPABASE_ANON_KEY`: Your Supabase anon key
- `VITE_API_URL`: Your Render backend URL (from step 1.4)

### 2.2 Enable GitHub Pages
1. Go to Settings → Pages
2. Source: "GitHub Actions"
3. The workflow will auto-deploy on push to main branch

### 2.3 Deploy Frontend
1. Push to main branch or manually trigger the workflow:
   ```bash
   git add .
   git commit -m "Deploy to production"
   git push origin main
   ```

2. Check Actions tab for deployment status
3. Your app will be live at: https://nicunursekatie.github.io/sandwichprojectplatform/

## Step 3: Verify Deployment

### Backend Health Check
```bash
curl https://your-render-url.onrender.com/api/health
```

### Frontend Access
Visit: https://nicunursekatie.github.io/sandwichprojectplatform/

## Troubleshooting

### Backend Issues
- Check Render logs for errors
- Verify all environment variables are set
- Ensure database connection string is correct
- Check CORS origin matches your GitHub Pages URL

### Frontend Issues
- Check GitHub Actions logs
- Verify secrets are set correctly
- Ensure API_URL points to your Render backend
- Check browser console for errors

### Database Issues
- Ensure IPv4 is enabled in Supabase
- Verify connection string uses port 6543 (pooler)
- Check password is URL-encoded (! becomes %21)

## Maintenance

### Update Backend
Push to main branch - Render auto-deploys

### Update Frontend
Push to main branch - GitHub Actions auto-deploys

### Update Environment Variables
- Backend: Render Dashboard → Environment
- Frontend: GitHub → Settings → Secrets

## Security Notes
- Never commit `.env` files
- Keep `SUPABASE_SERVICE_ROLE_KEY` secret
- Use HTTPS for all production URLs
- Regularly rotate API keys